# main.py
from manager import Manager
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã –∏ –∏—Ö –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –ø–∞–∫–µ—Ç–∞ classes
from classes import *

def create_initial_data():
    """–°–æ–∑–¥–∞–µ—Ç –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞."""
    print("--- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ---")
    try:
        user1 = User.create(1, "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤", "ivan.p@example.com")
        user2 = User.create(2, "–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞", "anna.s@example.com")
        user3 = User.create(3, "–û–ª–µ–≥ –í–æ–ª–∫–æ–≤", "oleg.v@example.com")
        
        addr1 = Address(city="–ú–æ—Å–∫–≤–∞", street="–¢–≤–µ—Ä—Å–∫–∞—è", building_number="10", postal_code=125009)
        addr2 = Address(city="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", street="–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç", building_number="25")
        
        house1 = Housing.create(101, addr1, 5500, "–£—é—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã")
        house2 = Housing.create(202, addr2, 4800, "–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã —Å –≤–∏–¥–æ–º –Ω–∞ –ù–µ–≤—Å–∫–∏–π")
        
        Booking.create(501, user1, house1, "2024-01-10", "2024-01-15")
        Review.create(1001, user1, house1, 5, "–û—Ç–ª–∏—á–Ω–æ–µ –º–µ—Å—Ç–æ!")
        
        print("‚úÖ –ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω.")
    except (ValueError, UserDataError, HousingDataError) as e:
        print(f"üî• –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: {e}")


def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –∑–∞—Ç–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç
    –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∏ –≤ –∫–æ–Ω—Ü–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    """
    print("--- –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON ---")
    Manager.load_from_json('data.json')

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –∏—Ö.
    if not User.get_all():
        print("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç.")
        create_initial_data()

    print("\n--- 1. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π ---")
    test_user = User.get(1)
    test_house = Housing.get(101)
    try:
        print("–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º ID...")
        User.create(-5, "–ü—Ä–∏–∑—Ä–∞–∫", "ghost@mail.com")
    except UserDataError as e:
        print(f"‚úÖ –ü–æ–π–º–∞–Ω–∞ –æ—à–∏–±–∫–∞: {e}")
    try:
        print("–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–∑—ã–≤ —Å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º...")
        Review.create(9999, test_user, test_house, 0, "–°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∞—è –æ—Ü–µ–Ω–∫–∞")
    except InvalidRatingError as e:
        print(f"‚úÖ –ü–æ–π–º–∞–Ω–∞ –æ—à–∏–±–∫–∞: {e}")
    try:
        print("–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º—Å—è ID...")
        User.create(1, "–î–≤–æ–π–Ω–∏–∫ –ò–≤–∞–Ω–∞", "fake@mail.com")
    except ValueError as e:
        print(f"‚úÖ –ü–æ–π–º–∞–Ω–∞ –æ—à–∏–±–∫–∞: {e}")
    
    print("\n--- 2. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è READ ---")
    print(f"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: {len(User.get_all())}")

    print(f"\n--- 3. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è UPDATE ---")
    user_to_update = User.get(1)
    if user_to_update:
        print(f"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID=1 –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {user_to_update.name}")
        user_to_update.update(name="–ò–≤–∞–Ω '–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π' –ü–µ—Ç—Ä–æ–≤")
        print(f"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID=1 –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {user_to_update.name}")
    
    print("\n--- 4. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è DELETE ---")
    user_to_delete = User.get(3)
    if user_to_delete:
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ —É–¥–∞–ª–µ–Ω–∏—è: {len(User.get_all())}")
        original_name = user_to_delete.name
        user_to_delete.delete()
        print(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '{original_name}' —É–¥–∞–ª–µ–Ω.")
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è: {len(User.get_all())}")
    
    print("\n--- 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ JSON ---")
    Manager.save_to_json('data.json')
    print("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ JSON —Ñ–∞–π–ª–∞...")
    Manager.load_from_json('data.json')
    print("\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ JSON:")
    review_from_json = Review.get(1001)
    if review_from_json:
        print(f"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞: '{review_from_json.comment}'")
    else:
        print("–û—Ç–∑—ã–≤ 1001 –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ JSON.")

    print("\n--- 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ XML ---")
    # –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ JSON) –≤ XML
    Manager.save_to_xml('data.xml')
    print("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ XML —Ñ–∞–π–ª–∞...")
    # –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã - –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ XML
    Manager.load_from_xml('data.xml')
    
    print("\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ XML:")
    print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –∂–∏–ª—å—è –≤ —Å–∏—Å—Ç–µ–º–µ: {len(Housing.get_all())}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–≤—è–∑–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–∞–π–¥—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    booking_from_xml = Booking.get(501)
    if booking_from_xml:
        # –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã Booking, User –∏ Housing –±—ã–ª–∏
        # —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω—ã –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.
        print(f"–ù–∞–π–¥–µ–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è '{booking_from_xml.user.name}' –Ω–∞ –∂–∏–ª—å–µ '{booking_from_xml.housing.description}'")
    else:
        print("–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ 501 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ XML.")


if __name__ == '__main__':
    main()